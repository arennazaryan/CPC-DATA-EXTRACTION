{% extends "base.html" %}
{% block content %}

<div class="row justify-content-center">
    <div class="col-12 col-lg-10">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-white border-bottom py-3 d-flex justify-content-between align-items-center">
                <h5 class="mb-0 text-primary fw-bold">
                    <i class="fas fa-history me-2"></i>{{ t('history_title') }}
                </h5>
                <a href="/" class="btn btn-outline-secondary btn-sm">
                    <i class="fas fa-arrow-left me-1"></i> {{ t('btn_back') }}
                </a>
            </div>
            <div class="card-body p-0">
                {% if history_items %}
                <div class="table-responsive">
                    <table class="table table-hover table-striped mb-0 align-middle">
                        <thead class="table-light">
                            <tr>
                                <th class="ps-4" style="min-width: 170px;">{{ t('col_date') }}</th>
                                <th>{{ t('col_section') }}</th>
                                <th>{{ t('col_year') }}</th>
                                <th>{{ t('col_records') }}</th>
                                <th>{{ t('col_status') }}</th>
                                <th class="text-end pe-4" style="min-width: 150px;">{{ t('col_actions') }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in history_items %}
                            <tr>
                                <td class="ps-4 text-muted fw-bold small">{{ item.date_str }}</td>
                                <td class="text-dark">{{ item.filters.row_name }}</td>
                                <td><span class="badge bg-light text-dark border">{{ item.filters.year }}</span></td>
                                <td>{{ item.total_rows }}</td>
                                <td>
                                    {# Logic: If status is 'finished' OR missing (old records), make it GREEN #}
                                    {% if item.status == 'finished' or not item.status %}
                                        <span class="badge rounded-pill px-3 py-2 text-white"
                                              style="background-color: #198754 !important; font-size: 0.85rem;">
                                            Finished
                                        </span>
                                    {% elif item.status == 'stopped' or item.stopped_early %}
                                        <span class="badge bg-warning text-dark rounded-pill px-3 py-2">Stopped</span>
                                    {% elif item.status == 'error' %}
                                        <span class="badge bg-danger text-white rounded-pill px-3 py-2">Error</span>
                                    {% else %}
                                        <span class="badge bg-secondary text-white rounded-pill px-3 py-2">
                                            {{ item.status }}
                                        </span>
                                    {% endif %}
                                </td>
                                <td class="text-end pe-4">
                                    <a href="{{ url_for('results.show_results', task_id=item.task_id) }}"
                                       class="btn btn-sm btn-outline-primary fw-bold text-nowrap d-inline-flex align-items-center justify-content-center px-4 py-1"
                                       style="gap: 8px;">
                                        <i class="fas fa-eye"></i>
                                        <span>{{ t('btn_results') }}</span>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5 text-muted">
                    <i class="fas fa-box-open fa-3x mb-3 opacity-25"></i>
                    <p>No history available yet.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}